language: go

go:
- '1.10.2'

install:
- go get -v -t ./...
- GOOS=windows go get -v -t ./...
- go get -v github.com/gobuffalo/packr/...
- go get -v github.com/mitchellh/gox
- go get -v github.com/gopherjs/gopherjs

script:
- set -e

# Test -----------------------------------------------------------------------
- go test -v ./hgl
- go test -v ./hangulize

# Build ----------------------------------------------------------------------
- mkdir -p build

  # pack bundle
- packr --compress --input ./hangulize -v

  # executable
- |
  gox -arch='amd64' \
      -os='linux darwin windows' \
      -output="build/hangulize_${TRAVIS_TAG}_{{.OS}}_{{.Arch}}" \
      -verbose

  # js
- gopherjs build ./js -o "build/hangulize-${TRAVIS_TAG}.js" -m -v
- rm -f build/*.js.map

deploy:
  provider: releases
  on:
    tags: true

  skip_cleanup: true
  file: build/*
  file_glob: true

  api_key:
    secure: XqIgJrNXveifpp95go4TfTFaaZo7o9pBz6hOGqCkTsRZaaMA0f1tMdnaR8uYy7xrG+vJGN0e7kVbTwG3RcvnXEDhb6ql/aR8pHOR9UVR7uejUt1MOgdh0GrAP5dS377hdRy1RDKOl9zon+VYxugln6ATyL3jDk3x0KSScNxIx+pEQOYNBcpmmE/5K9kIifYoegcaGTgjz/TjjRsvM7+D/MD12oqd7a5Iya2se8M7DiIvC6zuO+yrKfChV1d2Wo5V193QYBEz4WoDG+p2Gl+sp8hEtTZjTz1tJrY2PuVjlXmm8SZb6D5PhCz+JDnuR+zeHQz+7if2fM2xqBDXBqNhYw2nbBERzKp5FRvRFHop1G3x5FiVY57j2FE1XwwM4VFv5jddBb1lEuAfV4U2cQdlglymYAwW1DLNpwkxV7Nj9EJSUlDYuIu4Cos2/z7euijOkR/cOAQIsgUM1KdeSpPeT75byM4I90OL6AKT7ko2wWLqugc4DYSB3q8b9j2BN76qToNpdUQmcj61Im76vyLHNIA6qGq6V2FKZRQVCmWKlQSgBOuoIpdk0u8KX6nwcoWGft+bjvvbPqGwnoy9A4YYvNco29LyWmgS5cxZuLMEdu8rE+/caFchcRSWgBlCZTXthS4pzjk1nrCGu4Zeb+PFTB+ZAO2nwdyUb6cj+RFl+8I=
